#!/bin/ash
#
# entrypoint: Located at `/etc/container/entrypoint` this script is the custom
#             entry for a container as called by `/usr/bin/container-entrypoint` set
#             in the upstream [alpine-container](https://github.com/gautada/alpine-container).
#             The default template is kept in
#             [gist](https://gist.github.com/gautada/f185700af585a50b3884ad10c2b02f98)

ENTRYPOINT_PARAMS="$@"
. /etc/profile

CONTAINER_NAME="rabbitmq"

app_version() {
 /usr/sbin/rabbitmqctl status | /bin/grep "version" | /usr/bin/awk -F ' ' '{print $3}'
}

ep_pre_launch() {
 echo "FOO"
 #   -detached
}

ep_daemon_launch() {
 # /bin/sleep 5s
 # /usr/sbin/rabbitmqctl start_app
 echo "BOO"
}

ep_foreground_launch() {
 tail -f /dev/null
}

ep_post_launch() {
 echo "POST LAUNCH"
}

# /usr/bin/pgrep bean > /dev/null
# TEST=$?
# if [ $TEST -eq 1 ] ; then
#  log "-i" "entrypoint" "Launching application - $APP_NAME()"
#
#
#
# log "-i" "entrypoint" "Running application - $APP_NAME($(app_version))"
#fi
#
#if [ -z "$@" ] ; then
#  log "-i" "entrypoint" "Blocking application - $APP_NAME($(app_version))"
#
#  return 1
#else
# log "-i" "entrypoint" "Override default($ENTRYPOINT_PARAMS)"
# log "-i" "entrypoint" "Detatched application - $APP_NAME(NA)"
#
# return 0
# fi


REDIRECT="/mnt/volumes/container/_log"
# ep_pre_launch
if [ -z "$@" ] ; then
 /usr/sbin/rabbitmq-server
 return 1
else
 # ep_daemon_launch
 # export RABBITMQ_NODENAME="localhost"
  /usr/sbin/rabbitmq-server -detached
return 0
fi
